<%page args="artist, image, shortbio, fullbio, stylesheet, datasource, album, art_links, alb_links, link_images, similar" />
<%!
    import re
    import cgi
    remove_links = re.compile ('</?a[^>]*> ',re.VERBOSE)
    
    def cleanup(text):
        if text is None:
            return _("No information available")
        text = remove_links.sub ('', text)
        text = text.replace('\n', '</p><p>')
        return text
%>
<html>
<head>
<meta http-equiv="content-type" content="text-html; charset=utf-8">
<link rel="stylesheet" href="${stylesheet}" type="text/css" />
<style type="text/css">

.shown p,
.similar td,
.links a
{    font-size: 10pt;
    font-family: sans-serif;
}

.links img 
{ padding: 0 5px 0 5px }

.links ul 
{ list-style-type: none }

</style>
</head>
<body class="artist">
%if error is None:
<h1>${artist | h}</h1>
<img src="${image | h}" />
<div id="shortbio" class="shown">
    <% shortbio = cleanup(shortbio) %>
    <p>${shortbio}</p>
</div>

<div class="links">
    <h1>${ _("Links for %s:") % ("<em>" + artist + "</em>")}</h1>
    <ul>
        %for k, v in art_links.items() :
            <li><img src="${link_images}${k}16x16.png" /><a href="${v}">${k}</a></li>
        %endfor
    </ul>
    %if len(alb_links) > 0:
        <h1>${ _("Links for %s:") % ("<em>" + album + "</em>")}</h1>
    %endif
    <ul>
        %for k, v in alb_links.items() :
            <li><img src="${link_images}${k}16x16.png" /><a href="${v}">${k}</a></li>
        %endfor
</ul>
</div>

<div class="similar">
<h1>Similar Artists</h1>

<table id="similar">
    
%for i, entry in enumerate(similar) :
    <tr><td><img width="64" src="${entry['image_url'] | h}" alt="${entry['image_url'] | h}"/></td><td>${entry['name']} ${entry['similarity']}% similar</td></tr>
%endfor
</table>
</div>

<p>${datasource}</p>
%else:
<h1>${ _("Unable to retrieve artist information:") }</h1>
<p class="error">${error | h}</p>
%endif

</body>
</html>
